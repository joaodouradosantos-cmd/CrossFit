<!DOCTYPE html>
<html lang="pt">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Cross Moita ‚Äì 1RM</title>

  <!-- Cor da barra de topo nos telem√≥veis -->
  <meta name="theme-color" content="#f2f2f2" />
  <link rel="manifest" href="manifest.json" />

  <style>
    :root {
      font-family: system-ui, sans-serif;
      color-scheme: light;
    }

    /* FUNDO CLARO */
    body {
      margin: 0;
      background: #f2f2f2;
      color: #111111;
      display: flex;
      justify-content: center;
      min-height: 100vh;
    }

    .app {
      width: 100%;
      max-width: 900px;
      padding: 16px;
      box-sizing: border-box;
    }

    header {
      text-align: center;
      margin-bottom: 12px;
    }

    #appLogo {
      max-width: 220px;
      height: auto;
      display: block;
      margin: 0 auto 6px auto;
    }

    .subtitle {
      font-size: 0.85rem;
      color: #555;
    }

    /* CARDS */
    .card {
      background: #ffffff;
      border-radius: 14px;
      padding: 14px;
      margin-bottom: 16px;
      border: 1px solid #e0e0e0;
      box-shadow: 0 4px 10px rgba(0,0,0,0.04);
    }

    .form-row {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      margin-bottom: 8px;
    }

    .field {
      flex: 1;
      min-width: 140px;
      display: flex;
      flex-direction: column;
      gap: 4px;
    }

    label {
      font-size: 0.8rem;
      color: #444;
    }

    input, select, textarea, button {
      padding: 10px;
      border-radius: 10px;
      background: #ffffff;
      color: #111;
      border: 1px solid #cccccc;
      font-size: 0.9rem;
      box-sizing: border-box;
      font-family: inherit;
    }

    input:focus, select:focus, textarea:focus {
      outline: none;
      border-color: #22c55e;
      box-shadow: 0 0 0 1px rgba(34,197,94,0.2);
    }

    .btn-primary {
      background: #22c55e;
      border-color: #22c55e;
      color: #ffffff;
      font-weight: 600;
      cursor: pointer;
    }

    .btn-danger {
      background: #b91c1c;
      border-color: #991b1b;
      color: #ffffff;
      font-weight: 600;
      cursor: pointer;
      margin-left: 8px;
    }

    /* TABS */
    .tabs {
      display: flex;
      gap: 8px;
      margin: 10px 0 14px 0;
    }

    .tab-btn {
      flex: 1;
      padding: 10px 0;
      border-radius: 999px;
      border: 1px solid #cccccc;
      background: #e5e5e5;
      color: #222;
      cursor: pointer;
      font-size: 0.9rem;
    }

    .tab-btn.active {
      background: #22c55e;
      border-color: #22c55e;
      color: #ffffff;
      font-weight: 600;
    }

    .section { display: none; }
    .section.active { display: block; }

    /* TABELAS */
    table {
      width: 100%;
      border-collapse: collapse;
      font-size: 0.8rem;
      color: #111;
    }

    th, td {
      padding: 6px;
      text-align: center;
      border-bottom: 1px solid #dddddd;
      white-space: nowrap;
    }

    th {
      background: #f9f9f9;
      color: #333;
      position: sticky;
      top: 0;
      z-index: 1;
    }

    .scroll {
      max-height: 260px;
      overflow: auto;
      border-radius: 10px;
      border: 1px solid #e5e5e5;
    }

    /* BOT√ÉO APAGAR */
    .btn-delete {
      padding: 4px 8px;
      border-radius: 999px;
      border: 1px solid #e5e5e5;
      background: #f97373;
      color: #ffffff;
      font-size: 0.75rem;
      cursor: pointer;
    }

    .btn-delete:hover {
      background: #ef4444;
    }

    .helper-text {
      margin-top: 4px;
      font-size: 0.8rem;
      color: #444;
    }
  </style>
</head>

<body>
<div class="app">

  <header>
    <img id="appLogo" src="imagens/crossmoita_logo.png" alt="Cross Moita Logo">
    <div class="subtitle">Registo pessoal de treinos de for√ßa</div>
  </header>

  <!-- PERFIL -->
  <section class="card" id="perfil">
    <div id="perfilForm">
      <div class="form-row">
        <div class="field">
          <label>Sexo</label>
          <select id="sexo">
            <option value="">Selecionar</option>
            <option value="homem">Homem</option>
            <option value="mulher">Mulher</option>
          </select>
        </div>
        <div class="field">
          <label>Idade</label>
          <input id="idade" type="number" min="10" max="100" />
        </div>
      </div>

      <div class="form-row">
        <div class="field">
          <label>Altura (cm)</label>
          <input id="altura" type="number" min="100" max="230" />
        </div>
        <div class="field">
          <label>Peso (kg)</label>
          <input id="peso" type="number" step="0.1" min="30" max="250" />
        </div>
      </div>

      <button class="btn-primary" id="saveProfile">Guardar perfil</button>
    </div>

    <!-- Linha de resumo do perfil (fica sozinha depois de guardar) -->
    <div class="helper-text" id="profileInfo"></div>
  </section>

  <!-- TABS -->
  <div class="tabs">
    <button class="tab-btn active" data-target="sec-1rm">1RM</button>
    <button class="tab-btn" data-target="sec-treino">Treino</button>
  </div>

  <!-- 1RM -->
  <section id="sec-1rm" class="section active">

    <div class="card">
      <div class="form-row">
        <div class="field">
          <label>Exerc√≠cio</label>
          <select id="exercise"></select>
        </div>

        <div class="field">
          <label>1RM (kg) ‚Äì peso m√°ximo numa repeti√ß√£o</label>
          <input id="oneRm" type="number" step="0.5" />
        </div>
      </div>

      <button class="btn-primary" id="addBtn">Guardar / Atualizar</button>
    </div>

    <div class="card">
      <div class="scroll">
        <table>
          <thead>
            <tr>
              <th>Exerc√≠cio</th>
              <th>1RM</th>
              <th>25%</th>
              <th>30%</th>
              <th>35%</th>
              <th>40%</th>
              <th>50%</th>
              <th>60%</th>
              <th>70%</th>
              <th>75%</th>
              <th>80%</th>
              <th>85%</th>
              <th>90%</th>
              <th>95%</th>
              <th></th>
            </tr>
          </thead>
          <tbody id="tableBody"></tbody>
        </table>
      </div>
    </div>

  </section>

  <!-- TREINO (WOD + CARGA + SUGEST√ÉO) -->
  <section id="sec-treino" class="section">

    <!-- REGISTO DO TREINO DO DIA -->
    <div class="card">
      <div class="form-row">
        <div class="field">
          <label>Data</label>
          <input id="treinoData" type="date">
        </div>
        <div class="field">
          <label>Exerc√≠cio</label>
          <select id="treinoExercicio"></select>
        </div>
      </div>

      <div class="form-row">
        <div class="field">
          <label>Tipo</label>
          <select id="treinoTipo">
            <option value="">Selecionar</option>
            <option value="for√ßa">For√ßa</option>
            <option value="hipertrofia">Hipertrofia</option>
            <option value="t√©cnica">T√©cnica</option>
            <option value="metcon">Metcon</option>
          </select>
        </div>
        <div class="field">
          <label>Rondas / S√©ries</label>
          <input id="treinoRondas" type="number" min="1" />
        </div>
      </div>

      <div class="form-row">
        <div class="field">
          <label>Repeti√ß√µes por s√©rie</label>
          <input id="treinoReps" type="number" min="1" />
        </div>
        <div class="field">
          <label>Peso (kg)</label>
          <input id="treinoPeso" type="number" step="0.5" min="0" />
        </div>
      </div>

      <div class="form-row">
        <div class="field">
          <label>Tempo (opcional)</label>
          <input id="treinoTempo" type="text" placeholder="Ex.: 12:35, 20', AMRAP 10'..." />
        </div>
      </div>

      <button class="btn-primary" id="treinoAdd">Adicionar ao treino</button>
      <div class="helper-text">
        A carga de cada exerc√≠cio √© calculada como: peso √ó repeti√ß√µes √ó rondas.
      </div>
    </div>

    <!-- TABELA DO TREINO E RESUMO -->
    <div class="card">
      <div class="scroll">
        <table>
          <thead>
            <tr>
              <th>Data</th>
              <th>Exerc√≠cio</th>
              <th>Tipo</th>
              <th>Rondas</th>
              <th>Reps</th>
              <th>Peso</th>
              <th>% 1RM</th>
              <th>Tempo</th>
              <th>Carga</th>
              <th></th>
            </tr>
          </thead>
          <tbody id="treinoBody"></tbody>
        </table>
      </div>
      <div class="helper-text" id="treinoResumo"></div>
      <div class="helper-text" id="treinoSugestao" style="margin-top:4px; font-weight:500;"></div>
    </div>

  </section>

</div>

<script>
/* ===== PERFIL ===== */
const STORAGE_PROFILE = "crossfit_profile";
let profile = JSON.parse(localStorage.getItem(STORAGE_PROFILE) || "{}");

const sexoEl = document.getElementById("sexo");
const idadeEl = document.getElementById("idade");
const alturaEl = document.getElementById("altura");
const pesoEl = document.getElementById("peso");
const profileInfo = document.getElementById("profileInfo");
const perfilForm = document.getElementById("perfilForm");

function updateProfileInfo() {
  if (!profileInfo) return;

  if (!profile || !profile.peso) {
    profileInfo.textContent = "Preenche o perfil para personalizar a an√°lise da tua for√ßa.";
    if (perfilForm) perfilForm.style.display = "block";
    return;
  }

  let txt = "Peso atual: " + profile.peso + " kg";
  if (profile.idade) txt += " ¬∑ Idade: " + profile.idade + " anos";
  if (profile.sexo) {
    const sx = profile.sexo === "homem" ? "Homem" : "Mulher";
    txt += " ¬∑ Sexo: " + sx;
  }
  if (profile.altura) txt += " ¬∑ Altura: " + profile.altura + " cm";

  profileInfo.textContent = txt;

  // Esconde o formul√°rio para ganhar espa√ßo quando j√° est√° definido
  if (perfilForm) perfilForm.style.display = "none";
}

function loadProfile() {
  if (!sexoEl) return;
  if (profile.sexo) sexoEl.value = profile.sexo;
  if (profile.idade) idadeEl.value = profile.idade;
  if (profile.altura) alturaEl.value = profile.altura;
  if (profile.peso) pesoEl.value = profile.peso;
  updateProfileInfo();
}

const saveProfileBtn = document.getElementById("saveProfile");
if (saveProfileBtn) {
  saveProfileBtn.addEventListener("click", () => {
    profile = {
      sexo: sexoEl.value || "",
      idade: idadeEl.value ? parseInt(idadeEl.value, 10) : "",
      altura: alturaEl.value ? parseInt(alturaEl.value, 10) : "",
      peso: pesoEl.value ? parseFloat(pesoEl.value) : ""
    };
    localStorage.setItem(STORAGE_PROFILE, JSON.stringify(profile));
    updateProfileInfo();
    alert("Perfil atualizado.");
  });
}

/* ===== 1RM / EXERC√çCIOS ===== */
const MOVES = [
  "Chest Press",
  "Back Squat",
  "Front Squat",
  "Overhead Squat",
  "Deadlift",
  "Sumo Deadlift",
  "Romanian Deadlift (RDL)",
  "Power Clean",
  "Squat Clean",
  "Clean & Jerk",
  "Power Snatch",
  "Squat Snatch",
  "Push Press",
  "Push Jerk",
  "Split Jerk",
  "Strict Press",
  "Thruster",
  "Barbell Row",
  "Bent Over Row",
  "Good Morning",
  "Lunges com barra",
  "Hip Thrust com barra",
  "Dumbbell Press",
  "Dumbbell Bench Press",
  "Dumbbell Snatch",
  "Dumbbell Clean",
  "Dumbbell Clean & Jerk",
  "Dumbbell Thruster",
  "Dumbbell Row",
  "Dumbbell Lunges",
  "Kettlebell Swing",
  "Kettlebell Clean",
  "Kettlebell Snatch",
  "Goblet Squat",
  "Kettlebell Lunges"
];

/* percentagens 25‚Äì40% + 50‚Äì95% */
const PERC = [
  0.25, 0.30, 0.35, 0.40,
  0.50, 0.60, 0.70, 0.75,
  0.80, 0.85, 0.90, 0.95
];

const STORAGE_RM = "crossfit_1rm";
let dataRm = JSON.parse(localStorage.getItem(STORAGE_RM) || "{}");

const sel = document.getElementById("exercise");
const rm = document.getElementById("oneRm");
const bodyTable = document.getElementById("tableBody");

/* TREINO (WOD) */
const STORAGE_TREINO = "crossfit_treinos";
let treinos = JSON.parse(localStorage.getItem(STORAGE_TREINO) || "[]");

const treinoDataEl = document.getElementById("treinoData");
const treinoExEl = document.getElementById("treinoExercicio");
const treinoTipoEl = document.getElementById("treinoTipo");
const treinoRondasEl = document.getElementById("treinoRondas");
const treinoRepsEl = document.getElementById("treinoReps");
const treinoPesoEl = document.getElementById("treinoPeso");
const treinoTempoEl = document.getElementById("treinoTempo");
const treinoAddBtn = document.getElementById("treinoAdd");
const treinoBody = document.getElementById("treinoBody");
const treinoResumoEl = document.getElementById("treinoResumo");
const treinoSugestaoEl = document.getElementById("treinoSugestao");

/* Helpers */
function initSelect() {
  if (sel) {
    sel.innerHTML = "";
    MOVES.forEach(m => {
      const opt = document.createElement("option");
      opt.value = m;
      opt.textContent = m;
      sel.appendChild(opt);
    });
  }

  if (treinoExEl) {
    treinoExEl.innerHTML = "";
    MOVES.forEach(m => {
      const opt = document.createElement("option");
      opt.value = m;
      opt.textContent = m;
      treinoExEl.appendChild(opt);
    });
  }
}

function formatKg(v) {
  return v.toFixed(1).replace(".", ",") + " kg";
}

/* === Tabela 1RM === */
function deleteEx(name) {
  if (!name) return;
  if (!confirm(`Apagar o exerc√≠cio "${name}"?`)) return;
  delete dataRm[name];
  localStorage.setItem(STORAGE_RM, JSON.stringify(dataRm));
  renderRm();
}

function renderRm() {
  bodyTable.innerHTML = "";
  Object.keys(dataRm).sort().forEach(name => {
    const tr = document.createElement("tr");

    const tdName = document.createElement("td");
    tdName.textContent = name;
    tr.appendChild(tdName);

    const td1rm = document.createElement("td");
    let oneRmText = formatKg(dataRm[name]);
    if (profile && profile.peso) {
      const rel = dataRm[name] / profile.peso;
      oneRmText += " (" + rel.toFixed(2) + "x peso corporal)";
    }
    td1rm.textContent = oneRmText;
    tr.appendChild(td1rm);

    PERC.forEach(p => {
      const td = document.createElement("td");
      td.textContent = formatKg(dataRm[name] * p);
      tr.appendChild(td);
    });

    const tdDelete = document.createElement("td");
    const btn = document.createElement("button");
    btn.textContent = "üóë";
    btn.className = "btn-delete";
    btn.addEventListener("click", (e) => {
      e.stopPropagation();
      deleteEx(name);
    });
    tdDelete.appendChild(btn);
    tr.appendChild(tdDelete);

    bodyTable.appendChild(tr);
  });
}

/* Guardar / atualizar 1RM manual */
document.getElementById("addBtn").addEventListener("click", () => {
  const ex = sel.value;
  const val = parseFloat(rm.value);
  if (!ex || !val || val <= 0) return;
  dataRm[ex] = val;
  localStorage.setItem(STORAGE_RM, JSON.stringify(dataRm));
  rm.value = "";
  renderRm();
});

/* === TREINO: WOD / CARGA === */
function saveTreinos() {
  localStorage.setItem(STORAGE_TREINO, JSON.stringify(treinos));
}

function calcCarga(entry) {
  const peso = entry.peso || 0;
  const reps = entry.reps || 0;
  const rondas = entry.rondas || 1;
  return peso * reps * rondas;
}

function addTreinoEntry() {
  const date = treinoDataEl.value || new Date().toISOString().slice(0,10);
  const ex = treinoExEl.value;
  const tipo = treinoTipoEl.value;
  const rondas = parseInt(treinoRondasEl.value || "1", 10);
  const reps = parseInt(treinoRepsEl.value || "0", 10);
  const peso = parseFloat(treinoPesoEl.value || "0");
  const tempo = treinoTempoEl.value.trim();

  if (!ex || !reps || reps <= 0) return;

  const carga = calcCarga({ peso, reps, rondas });
  let perc1rm = null;
  if (dataRm[ex] && dataRm[ex] > 0 && peso > 0) {
    perc1rm = peso / dataRm[ex];
  }

  const entry = {
    date,
    ex,
    tipo,
    rondas,
    reps,
    peso,
    tempo,
    carga,
    perc1rm
  };

  treinos.unshift(entry);
  saveTreinos();
  renderTreinos();

  treinoRondasEl.value = "";
  treinoRepsEl.value = "";
  treinoPesoEl.value = "";
  treinoTempoEl.value = "";
}

function deleteTreinoEntry(index) {
  if (index < 0 || index >= treinos.length) return;
  if (!confirm("Apagar este registo de treino?")) return;
  treinos.splice(index, 1);
  saveTreinos();
  renderTreinos();
}

function renderTreinos() {
  if (!treinoBody) return;
  treinoBody.innerHTML = "";

  const dia = treinoDataEl.value || new Date().toISOString().slice(0,10);
  const lista = treinos.filter(t => t.date === dia);

  if (!lista.length) {
    treinoResumoEl.textContent = "Sem treino registado para " + dia + ".";
    treinoSugestaoEl.textContent = "";
    return;
  }

  let totalCarga = 0;
  let totalSeries = 0;
  let blocosForca = 0;
  let blocosHipertrofia = 0;
  let blocosLeve = 0;

  lista.forEach(e => {
    const tr = document.createElement("tr");

    const tdDate = document.createElement("td");
    tdDate.textContent = e.date || "";
    tr.appendChild(tdDate);

    const tdEx = document.createElement("td");
    tdEx.textContent = e.ex;
    tr.appendChild(tdEx);

    const tdTipo = document.createElement("td");
    tdTipo.textContent = e.tipo || "";
    tr.appendChild(tdTipo);

    const tdR = document.createElement("td");
    tdR.textContent = e.rondas || "";
    tr.appendChild(tdR);

    const tdReps = document.createElement("td");
    tdReps.textContent = e.reps || "";
    tr.appendChild(tdReps);

    const tdPeso = document.createElement("td");
    tdPeso.textContent = e.peso ? formatKg(e.peso) : "";
    tr.appendChild(tdPeso);

    const tdPerc = document.createElement("td");
    if (e.perc1rm) {
      tdPerc.textContent = (e.perc1rm * 100).toFixed(0) + "%";
    } else {
      tdPerc.textContent = "";
    }
    tr.appendChild(tdPerc);

    const tdTempo = document.createElement("td");
    tdTempo.textContent = e.tempo || "";
    tr.appendChild(tdTempo);

    const tdCarga = document.createElement("td");
    tdCarga.textContent = e.carga ? formatKg(e.carga) : "";
    tr.appendChild(tdCarga);

    const tdDel = document.createElement("td");
    const btn = document.createElement("button");
    btn.textContent = "üóë";
    btn.className = "btn-delete";
    btn.addEventListener("click", () => deleteTreinoEntry(treinos.indexOf(e)));
    tdDel.appendChild(btn);
    tr.appendChild(tdDel);

    treinoBody.appendChild(tr);

    totalCarga += e.carga || 0;
    totalSeries += (e.rondas || 0);

    if (e.perc1rm && e.reps) {
      const p = e.perc1rm;
      const r = e.reps;
      if (p >= 0.8 && r <= 5) {
        blocosForca++;
      } else if (p >= 0.65 && p <= 0.8 && r >= 6 && r <= 12) {
        blocosHipertrofia++;
      } else if (p < 0.6 || r >= 15) {
        blocosLeve++;
      }
    }
  });

  // RESUMO APENAS NA P√ÅGINA DE TREINO: data + carga total
  treinoResumoEl.textContent =
    "Resumo do dia " + dia + ": carga total do treino = " + formatKg(totalCarga);

  // Sugest√£o de melhoria (objetivo: crescer e ganhar for√ßa)
  let sugestao = "";

  if (blocosForca === 0 && blocosHipertrofia === 0) {
    sugestao = "Para crescer e ganhar for√ßa, inclui blocos a ~70‚Äì85% 1RM, entre 5‚Äì10 repeti√ß√µes, nos principais levantamentos.";
  } else if (blocosForca > 0 && blocosHipertrofia === 0) {
    sugestao = "Treino muito focado em for√ßa m√°xima. Para ganhar mais massa, adiciona 2‚Äì4 s√©ries de 6‚Äì10 repeti√ß√µes a ~70‚Äì75% 1RM em 1‚Äì2 exerc√≠cios grandes.";
  } else if (blocosHipertrofia > 0 && blocosForca === 0) {
    sugestao = "Est√°s a trabalhar bem a hipertrofia. Para refor√ßar a for√ßa, inclui 2‚Äì3 s√©ries mais pesadas (3‚Äì5 repeti√ß√µes a ~80‚Äì85% 1RM) em movimentos fundamentais.";
  } else {
    sugestao = "Boa combina√ß√£o de for√ßa e hipertrofia. Mant√©m: 2‚Äì3 exerc√≠cios principais pesados (3‚Äì5 reps a 80‚Äì85% 1RM) e 2‚Äì3 exerc√≠cios de apoio com 6‚Äì12 reps a 65‚Äì75% 1RM.";
  }

  if (profile && profile.idade && profile.idade > 40) {
    sugestao += " Ajusta o volume √† recupera√ß√£o: prioriza qualidade de movimento e evita acumular fadiga excessiva.";
  }

  treinoSugestaoEl.textContent = sugestao;
}

if (treinoAddBtn) {
  treinoAddBtn.addEventListener("click", addTreinoEntry);
}

/* TABS */
document.querySelectorAll(".tab-btn").forEach(btn => {
  btn.addEventListener("click", () => {
    document.querySelectorAll(".tab-btn").forEach(b => b.classList.remove("active"));
    btn.classList.add("active");

    const target = btn.dataset.target;
    document.querySelectorAll(".section").forEach(s => s.classList.remove("active"));
    document.getElementById(target).classList.add("active");
  });
});

/* INIT */
initSelect();
loadProfile();
renderRm();

/* Data do treino = hoje por defeito */
if (treinoDataEl && !treinoDataEl.value) {
  treinoDataEl.value = new Date().toISOString().slice(0, 10);
}
renderTreinos();
</script>

</body>
</html>
