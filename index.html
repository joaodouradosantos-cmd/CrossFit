<!DOCTYPE html>
<html lang="pt">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>CrossBox</title>

  <meta name="theme-color" content="#f2f2f2" />
  <link rel="manifest" href="manifest.json" />

  <link rel="apple-touch-icon" sizes="180x180" href="imagens/crossbox_logo.png" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="default" />

  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

  <style>
    :root {
      font-family: system-ui, sans-serif;
      color-scheme: light;
    }

    body {
      background:
        /*
        Imagem abstracta tipo parede de box de CrossFit,
        com textura ligeira e uma ilumina√ß√£o difusa
        em tons de cinzento e verde muito suave.
        */
        radial-gradient(circle at top, rgba(15, 118, 110, 0.08), transparent 55%),
        radial-gradient(circle at bottom, rgba(30, 64, 175, 0.08), transparent 60%),
        linear-gradient(135deg, #050816, #020617);
      margin: 0;
      padding: 0;
      color: #f9fafb;
    }

    .app {
      max-width: 980px;
      margin: 0 auto;
      padding: 8px;
      box-sizing: border-box;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
    }

    header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 8px;
      gap: 8px;
    }

    #appLogo {
      height: 40px;
      width: 40px;
      border-radius: 12px;
      object-fit: cover;
      box-shadow: 0 0 0 2px rgba(34, 197, 94, 0.8);
    }

    .subtitle {
      font-size: 0.9rem;
      opacity: 0.95;
    }

    /* Bot√£o Reservas em destaque na barra */
    #reservasBtn {
      font-size: 0.8rem;
      padding: 6px 10px;
    }

    h1 {
      font-size: 1.3rem;
      margin: 0 0 4px;
      letter-spacing: 0.03em;
    }

    h2 {
      font-size: 1.1rem;
      margin: 0 0 4px;
      letter-spacing: 0.02em;
    }

    h3 {
      font-size: 1rem;
      margin: 0 0 6px;
    }

    h4 {
      font-size: 0.95rem;
      margin: 0 0 4px;
    }

    p {
      margin: 0 0 4px;
      font-size: 0.85rem;
    }

    small {
      font-size: 0.75rem;
      opacity: 0.85;
    }

    .helper-text {
      font-size: 0.8rem;
      opacity: 0.9;
      margin-bottom: 6px;
    }

    .card {
      background: rgba(15, 23, 42, 0.94);
      border-radius: 12px;
      padding: 8px;
      margin-bottom: 8px;
      border: 1px solid rgba(148, 163, 184, 0.3);
      box-shadow:
        0 10px 20px rgba(15, 23, 42, 0.9),
        0 0 0 1px rgba(15, 23, 42, 0.8);
      backdrop-filter: blur(20px);
    }

    .card-ghost {
      background: transparent;
      border-radius: 10px;
      padding: 8px;
      margin-bottom: 8px;
      border: 1px dashed rgba(148, 163, 184, 0.4);
    }

    .card-compact {
      background: rgba(15, 23, 42, 0.92);
      border-radius: 10px;
      padding: 6px;
      margin-bottom: 6px;
      border: 1px solid rgba(75, 85, 99, 0.6);
    }

    .tabs {
      display: flex;
      gap: 6px;
      margin-bottom: 8px;
    }

    .tab-btn {
      flex: 1;
      padding: 6px 8px;
      border-radius: 999px;
      border: 1px solid rgba(148, 163, 184, 0.7);
      background: linear-gradient(135deg, rgba(15, 23, 42, 0.9), rgba(15, 23, 42, 0.7));
      color: #e5e7eb;
      font-size: 0.8rem;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 6px;
      transition:
        background 0.18s ease,
        box-shadow 0.18s ease,
        border-color 0.18s ease,
        transform 0.08s ease;
    }

    .tab-btn span.emoji {
      font-size: 1rem;
    }

    .tab-btn.active {
      background: radial-gradient(circle at top left, #22c55e, #15803d);
      border-color: rgba(34, 197, 94, 0.9);
      box-shadow:
        0 10px 20px rgba(22, 163, 74, 0.45),
        0 0 0 1px rgba(15, 23, 42, 0.8);
      color: #f9fafb;
      transform: translateY(-1px);
    }

    .tab-btn:not(.active):hover {
      border-color: rgba(148, 163, 184, 1);
      box-shadow:
        0 8px 16px rgba(15, 23, 42, 0.85),
        0 0 0 1px rgba(15, 23, 42, 0.9);
      transform: translateY(-0.5px);
    }

    .section {
      display: none;
    }

    .section.active {
      display: block;
    }

    .form-row {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      margin-bottom: 8px;
    }

    .field {
      flex: 1;
      min-width: 120px;
      display: flex;
      flex-direction: column;
      gap: 2px;
    }

    label {
      font-size: 0.8rem;
      opacity: 0.9;
    }

    input,
    select,
    textarea {
      width: 100%;
      padding: 6px 8px;
      border-radius: 8px;
      border: 1px solid rgba(148, 163, 184, 0.8);
      background: rgba(15, 23, 42, 0.9);
      color: #e5e7eb;
      font-size: 0.85rem;
      box-sizing: border-box;
      transition:
        border-color 0.18s ease,
        box-shadow 0.18s ease,
        background 0.18s ease,
        transform 0.06s ease;
    }

    input::placeholder,
    textarea::placeholder {
      color: rgba(148, 163, 184, 0.9);
      font-size: 0.8rem;
    }

    input:focus,
    select:focus,
    textarea:focus {
      outline: none;
      border-color: #22c55e;
      box-shadow: 0 0 0 1px rgba(34, 197, 94, 0.25);
    }

    /* BOT√ïES */
    .btn-primary {
      background:
        linear-gradient(145deg, #1f7b3a, #0f4220);
      border: 1px solid rgba(34, 197, 94, 0.9);
      color: #ecfdf5;
      padding: 6px 10px;
      border-radius: 999px;
      font-size: 0.8rem;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 4px;
      box-shadow:
        0 10px 20px rgba(22, 163, 74, 0.5),
        0 0 0 1px rgba(15, 23, 42, 0.9);
      transition:
        background 0.16s ease,
        box-shadow 0.16s ease,
        transform 0.08s ease;
    }

    .btn-primary:hover {
      background:
        radial-gradient(circle at top left, #22c55e, #166534);
      box-shadow:
        0 14px 24px rgba(22, 163, 74, 0.6),
        0 0 0 1px rgba(15, 23, 42, 1);
      transform: translateY(-0.5px);
    }

    .btn-primary:active {
      transform: translateY(0.5px) scale(0.99);
      box-shadow:
        0 8px 16px rgba(22, 163, 74, 0.4),
        0 0 0 1px rgba(15, 23, 42, 0.9);
    }

    .btn-secondary {
      background: rgba(15, 23, 42, 0.9);
      border: 1px solid rgba(148, 163, 184, 0.9);
      color: #e5e7eb;
      padding: 6px 10px;
      border-radius: 999px;
      font-size: 0.8rem;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 4px;
      box-shadow:
        0 8px 16px rgba(15, 23, 42, 0.9),
        0 0 0 1px rgba(15, 23, 42, 1);
      transition:
        background 0.16s ease,
        border-color 0.16s ease,
        box-shadow 0.16s ease,
        transform 0.08s ease;
    }

    .btn-secondary:hover {
      background: rgba(15, 23, 42, 0.95);
      border-color: rgba(148, 163, 184, 1);
      box-shadow:
        0 10px 20px rgba(15, 23, 42, 1),
        0 0 0 1px rgba(15, 23, 42, 1);
      transform: translateY(-0.5px);
    }

    .btn-secondary:active {
      transform: translateY(0.5px) scale(0.99);
      box-shadow:
        0 6px 12px rgba(15, 23, 42, 0.9),
        0 0 0 1px rgba(15, 23, 42, 1);
    }

    .btn-danger {
      background: rgba(127, 29, 29, 0.9);
      border: 1px solid rgba(239, 68, 68, 0.9);
      color: #fee2e2;
      padding: 4px 8px;
      border-radius: 999px;
      font-size: 0.75rem;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 4px;
      box-shadow:
        0 8px 16px rgba(127, 29, 29, 0.9),
        0 0 0 1px rgba(15, 23, 42, 1);
      transition:
        background 0.16s ease,
        box-shadow 0.16s ease,
        transform 0.08s ease;
    }

    .btn-danger:hover {
      background: rgba(185, 28, 28, 0.95);
      box-shadow:
        0 12px 20px rgba(127, 29, 29, 1),
        0 0 0 1px rgba(15, 23, 42, 1);
      transform: translateY(-0.5px);
    }

    .btn-danger:active {
      transform: translateY(0.5px) scale(0.99);
      box-shadow:
        0 6px 12px rgba(127, 29, 29, 0.9),
        0 0 0 1px rgba(15, 23, 42, 1);
    }

    table {
      width: 100%;
      border-collapse: collapse;
      font-size: 0.75rem;
    }

    th,
    td {
      border-bottom: 1px solid rgba(51, 65, 85, 0.8);
      padding: 4px 6px;
      text-align: left;
      white-space: nowrap;
    }

    thead th {
      position: sticky;
      top: 0;
      z-index: 1;
      background: rgba(15, 23, 42, 0.98);
    }

    .scroll {
      max-height: 220px;
      overflow: auto;
      border-radius: 8px;
      border: 1px solid rgba(51, 65, 85, 0.9);
      background: rgba(15, 23, 42, 0.9);
      box-shadow:
        inset 0 0 0 1px rgba(15, 23, 42, 0.95);
    }

    .section-title-row {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 8px;
      margin-bottom: 4px;
    }

    .section-title-row h3 {
      margin: 0;
    }

    .section-title-row small {
      font-size: 0.7rem;
      opacity: 0.8;
    }

    .chip {
      display: inline-flex;
      align-items: center;
      gap: 4px;
      padding: 2px 6px;
      border-radius: 999px;
      border: 1px solid rgba(148, 163, 184, 0.8);
      background: rgba(15, 23, 42, 0.9);
      font-size: 0.7rem;
      color: #e5e7eb;
    }

    .chip strong {
      font-weight: 600;
    }

    .options-grid {
      display: grid;
      grid-template-columns: repeat(3, minmax(0, 1fr));
      gap: 6px;
    }

    .opt-btn {
      flex-direction: column;
      align-items: flex-start;
      justify-content: flex-start;
      padding: 8px;
      border-radius: 10px;
      background: radial-gradient(circle at top left, rgba(15, 23, 42, 0.98), rgba(15, 23, 42, 0.9));
      border-color: rgba(75, 85, 99, 0.9);
      min-height: 60px;
      box-shadow:
        0 10px 18px rgba(15, 23, 42, 0.95),
        0 0 0 1px rgba(15, 23, 42, 1);
    }

    .opt-btn .opt-emoji {
      font-size: 1.1rem;
    }

    .opt-btn span:last-child {
      font-size: 0.8rem;
      margin-top: 4px;
    }

    .opt-btn.active {
      border-color: rgba(34, 197, 94, 0.9);
      box-shadow:
        0 12px 22px rgba(22, 163, 74, 0.6),
        0 0 0 1px rgba(15, 23, 42, 1);
    }

    .option-section {
      margin-top: 8px;
      display: none;
    }

    .option-section.active {
      display: block;
    }

    .badge {
      display: inline-flex;
      align-items: center;
      gap: 4px;
      padding: 2px 6px;
      border-radius: 999px;
      border: 1px solid rgba(96, 165, 250, 0.9);
      background: rgba(30, 64, 175, 0.85);
      color: #dbeafe;
      font-size: 0.7rem;
      margin-right: 4px;
    }

    .badge.green {
      border-color: rgba(34, 197, 94, 0.9);
      background: rgba(22, 163, 74, 0.85);
      color: #dcfce7;
    }

    .badge.amber {
      border-color: rgba(245, 158, 11, 0.9);
      background: rgba(217, 119, 6, 0.85);
      color: #fffbeb;
    }

    .badge.red {
      border-color: rgba(248, 113, 113, 0.9);
      background: rgba(220, 38, 38, 0.85);
      color: #fee2e2;
    }

    .history-list {
      list-style: none;
      padding: 0;
      margin: 0;
      font-size: 0.8rem;
    }

    .history-list li {
      border-bottom: 1px dashed rgba(51, 65, 85, 0.8);
      padding: 4px 0;
      display: flex;
      flex-direction: column;
      gap: 2px;
    }

    .tag {
      display: inline-flex;
      align-items: center;
      gap: 4px;
      padding: 1px 5px;
      border-radius: 999px;
      border: 1px solid rgba(148, 163, 184, 0.7);
      background: rgba(15, 23, 42, 0.9);
      font-size: 0.7rem;
      color: #e5e7eb;
    }

    .tag span {
      font-size: 0.7rem;
    }

    .tag + .tag {
      margin-left: 4px;
    }

    .history-tags {
      display: flex;
      flex-wrap: wrap;
      gap: 4px;
    }

    .history-main {
      font-weight: 500;
      font-size: 0.8rem;
    }

    .history-meta {
      font-size: 0.75rem;
      opacity: 0.9;
    }

    .history-actions {
      display: flex;
      gap: 4px;
      margin-top: 2px;
    }

    .section-note {
      font-size: 0.75rem;
      opacity: 0.85;
      margin-top: 4px;
    }

    @media (max-width: 600px) {
      .options-grid {
        grid-template-columns: repeat(3, minmax(0, 1fr));
      }

      #reservasBtn {
        font-size: 0.75rem;
        padding: 5px 8px;
      }
    }
  </style>
</head>
<body>
<div class="app">

  <header>
    <img id="appLogo" src="imagens/crossbox_logo.png" alt="Log√≥tipo CrossBox">
    <div class="subtitle" id="appSubtitle">Registo pessoal de treinos CrossBox</div>
    <button id="reservasBtn" class="btn-secondary">Reservas &amp; presen√ßas</button>
  </header>

  <div class="tabs">
    <button class="tab-btn active" data-target="sec-1rm">
      <span class="emoji">üèãÔ∏è‚Äç‚ôÇÔ∏è</span>
      <span>1RM</span>
    </button>
    <button class="tab-btn" data-target="sec-opcoes">
      <span class="emoji">üß∞</span>
      <span>WOD &amp; Tools CrossBox</span>
    </button>
  </div>

  <!-- SEC√á√ÉO 1: 1RM & PERFIL & RESERVAS -->
  <section id="sec-1rm" class="section active">

    <!-- PERFIL -->
    <section id="sec-perfil" class="card">
      <div class="section-title-row">
        <h3>üë§ Perfil do atleta</h3>
        <small id="perfilResumo"></small>
      </div>
      <p class="helper-text">
        Define o teu perfil para ajustar melhor os c√°lculos (por exemplo, rela√ß√£o 1RM / peso corporal).
      </p>

      <div id="perfilForm">
        <div class="form-row">
          <div class="field">
            <label>Nome do atleta</label>
            <input id="nome" type="text" placeholder="Ex.: Jo√£o, Ana, Coach..." />
          </div>
          <div class="field">
            <label>N√≠vel de treino</label>
            <select id="nivel">
              <option value="">Selecionar</option>
              <option value="iniciante">Iniciante</option>
              <option value="interm√©dio">Interm√©dio</option>
              <option value="avan√ßado">Avan√ßado</option>
              <option value="competidor">Competidor</option>
            </select>
          </div>
        </div>

        <div class="form-row">
          <div class="field">
            <label>Sexo</label>
            <select id="sexo">
              <option value="">Selecionar</option>
              <option value="masculino">Masculino</option>
              <option value="feminino">Feminino</option>
              <option value="outro">Outro / Prefiro n√£o dizer</option>
            </select>
          </div>
          <div class="field">
            <label>Idade (anos)</label>
            <input id="idade" type="number" min="10" max="90" />
          </div>
        </div>

        <div class="form-row">
          <div class="field">
            <label>Altura (cm)</label>
            <input id="altura" type="number" min="100" max="230" />
          </div>
          <div class="field">
            <label>Peso atual (kg)</label>
            <input id="peso" type="number" step="0.1" min="30" max="250" />
          </div>
        </div>

        <button class="btn-primary" id="saveProfile">Guardar perfil do atleta</button>
      </div>
    </section>

    <!-- RESERVAS & PRESEN√áAS (ATALHO NO TOPO) -->
    <section id="sec-reservas" class="card">
      <h3 style="margin-top:0; margin-bottom:8px;">üìÜ Reservas &amp; presen√ßas</h3>
      <p class="helper-text">
        Regista as tuas reservas e presen√ßas nas aulas. Estes dados s√£o pessoais e n√£o s√£o enviados para nenhum servidor.
      </p>

      <div class="form-row">
        <div class="field">
          <label>Data da aula</label>
          <input id="reservaData" type="date" />
        </div>
        <div class="field">
          <label>Hora da aula</label>
          <input id="reservaHora" type="time" />
        </div>
        <div class="field">
          <label>Tipo de aula</label>
          <select id="reservaTipo">
            <option value="">Selecionar</option>
            <option value="WOD">WOD</option>
            <option value="Open box">Open box</option>
            <option value="T√©cnica / Halterofilia">T√©cnica / Halterofilia</option>
            <option value="Mobilidade / Recupera√ß√£o">Mobilidade / Recupera√ß√£o</option>
          </select>
        </div>
      </div>

      <div class="form-row">
        <div class="field">
          <label>Nota (opcional)</label>
          <input id="reservaNota" type="text" placeholder="Ex.: parceiro de treino, foco ou objetivo do dia..." />
        </div>
      </div>

      <button class="btn-primary" id="reservaAddBtn">Guardar reserva</button>

      <p class="section-note">
        Estas reservas e presen√ßas s√£o pessoais e ficam apenas guardadas neste dispositivo, em modo offline.
      </p>

      <div class="card-compact" style="margin-top:8px;">
        <h4 style="margin-top:0; margin-bottom:4px;">Resumo r√°pido</h4>
        <div id="reservasResumo"></div>
      </div>

      <div class="card-compact" style="margin-top:6px;">
        <h4 style="margin-top:0; margin-bottom:4px;">Hist√≥rico de reservas / presen√ßas</h4>
        <div class="scroll">
          <table>
            <thead>
              <tr>
                <th>Data</th>
                <th>Hora</th>
                <th>Tipo</th>
                <th>Nota</th>
                <th>Presen√ßa</th>
                <th></th>
              </tr>
            </thead>
            <tbody id="reservasBody"></tbody>
          </table>
        </div>
      </div>
    </section>

    <!-- 1RM -->
    <section class="card">
      <div class="section-title-row">
        <h3>üèãÔ∏è‚Äç‚ôÇÔ∏è Maxes (1RM)</h3>
        <div>
          <span class="chip">
            <strong>1RM</strong>
            <span>peso m√°ximo para 1 repeti√ß√£o</span>
          </span>
        </div>
      </div>

      <div class="form-row">
        <div class="field">
          <label>Exerc√≠cio</label>
          <select id="exercise">
            <option value="">Selecionar</option>
          </select>
        </div>
        <div class="field">
          <label>1RM (kg) ‚Äì peso m√°ximo para 1 repeti√ß√£o</label>
          <input id="oneRm" type="number" step="0.5" min="0" />
        </div>
      </div>

      <div class="form-row">
        <button class="btn-primary" id="addBtn">Guardar / Atualizar</button>
      </div>

      <div class="card-compact">
        <h4 style="margin-top:0; margin-bottom:4px;">Tabela de percentagens (1RM)</h4>
        <div class="scroll">
          <table>
            <thead>
              <tr>
                <th>Exerc√≠cio</th>
                <th>1RM</th>
                <th>25%</th>
                <th>30%</th>
                <th>35%</th>
                <th>40%</th>
                <th>50%</th>
                <th>60%</th>
                <th>65%</th>
                <th>70%</th>
                <th>75%</th>
                <th>80%</th>
                <th>85%</th>
                <th>90%</th>
                <th>95%</th>
                <th></th>
              </tr>
            </thead>
            <tbody id="tableBody"></tbody>
          </table>
        </div>
      </div>
    </section>

  </section>

  <!-- SEC√á√ÉO 2: OP√á√ïES -->
  <section id="sec-opcoes" class="section">

    <div class="card">
      <div class="options-grid">
        <button class="btn-secondary opt-btn" data-target="opt-wod">
          <span class="opt-emoji">üü©</span>
          <span>WOD di√°rio</span>
        </button>
        <button class="btn-secondary opt-btn" data-target="opt-objetivo">
          <span class="opt-emoji">üßÆ</span>
          <span>Objetivo de treino</span>
        </button>
        <button class="btn-secondary opt-btn" data-target="opt-graficos">
          <span class="opt-emoji">üìà</span>
          <span>Gr√°fico 1RM</span>
        </button>
        <button class="btn-secondary opt-btn" data-target="opt-performance">
          <span class="opt-emoji">üèÖ</span>
          <span>Desempenho</span>
        </button>
        <button class="btn-secondary opt-btn" data-target="opt-guia">
          <span class="opt-emoji">üìö</span>
          <span>Guia de exerc√≠cios</span>
        </button>
        <button class="btn-secondary opt-btn" data-target="opt-backup">
          <span class="opt-emoji">üíæ</span>
          <span>Backup de dados</span>
        </button>
      </div>
    </div>

    <!-- WOD -->
    <section id="opt-wod" class="option-section">
      <div class="card">
        <h3 style="margin-top:0; margin-bottom:8px;">üü© WOD do dia</h3>

        <div class="form-row">
          <div class="field">
            <label>Data</label>
            <input id="treinoData" type="date">
          </div>
          <div class="field">
            <label>Exerc√≠cio</label>
            <input id="treinoExercicioSearch" type="text" placeholder="Procurar exerc√≠cio (EN/PT)..." />
            <select id="treinoExercicio"></select>
          </div>
        </div>

        <div class="form-row">
          <div class="field">
            <label>Tipo de trabalho</label>
            <select id="treinoTipo">
              <option value="">Selecionar</option>
              <option value="for√ßa">For√ßa</option>
              <option value="hipertrofia">Hipertrofia</option>
              <option value="t√©cnica">T√©cnica</option>
              <option value="metcon">Metcon</option>
            </select>
          </div>
          <div class="field">
            <label>Rondas / S√©ries</label>
            <input id="treinoRondas" type="number" min="1" />
          </div>
        </div>

        <div class="form-row">
          <div class="field">
            <label>Repeti√ß√µes por s√©rie</label>
            <input id="treinoReps" type="number" min="1" />
          </div>
          <div class="field">
            <label>Peso usado (kg)</label>
            <input id="treinoPeso" type="number" step="0.5" min="0" />
          </div>
        </div>

        <div class="form-row">
          <div class="field">
            <label>Tempo (para rankings de metcon, opcional)</label>
            <input id="treinoTempo" type="text" placeholder="Ex.: 12:35 (para rankings), 20', AMRAP 10'..." />
          </div>
          <div class="field">
            <label>Dist√¢ncia (km ‚Äì metcon, opcional)</label>
            <input id="treinoDist" type="number" step="0.01" min="0" />
          </div>
        </div>

        <button class="btn-primary" id="treinoAdd">Adicionar exerc√≠cio ao WOD</button>

        <div class="card-compact" style="margin-top:8px;">
          <h4 style="margin-top:0; margin-bottom:4px;">Hist√≥rico WOD (recentes)</h4>
          <div class="scroll">
            <table>
              <thead>
                <tr>
                  <th>Data</th>
                  <th>Exerc√≠cio</th>
                  <th>Tipo</th>
                  <th>Rondas</th>
                  <th>Reps</th>
                  <th>Peso</th>
                  <th>Tempo</th>
                  <th>Dist√¢ncia</th>
                  <th></th>
                </tr>
              </thead>
              <tbody id="treinoBody"></tbody>
            </table>
          </div>
          <p class="section-note">
            Ver hist√≥rico di√°rio completo
          </p>
        </div>
      </div>
    </section>

    <!-- OBJETIVO -->
    <section id="opt-objetivo" class="option-section">
      <div class="card">
        <h3 style="margin-top:0; margin-bottom:8px;">üßÆ Objetivo de treino</h3>
        <p class="helper-text">
          Usa o teu 1RM para definir um objetivo por exerc√≠cio e deixa a app sugerir carga, volume e progress√£o.
        </p>

        <div class="form-row">
          <div class="field">
            <label>Exerc√≠cio</label>
            <select id="calcExercicio"></select>
          </div>
          <div class="field">
            <label>N.¬∫ de repeti√ß√µes planeadas</label>
            <input id="calcReps" type="number" min="1" />
          </div>
        </div>

        <div class="form-row">
          <div class="field">
            <label>Objetivo</label>
            <select id="calcObjetivo">
              <option value="">Selecionar</option>
              <option value="for√ßa">For√ßa</option>
              <option value="hipertrofia">Hipertrofia</option>
              <option value="t√©cnica">T√©cnica</option>
            </select>
          </div>
          <div class="field">
            <label>Peso objetivo (kg ‚Äì opcional)</label>
            <input id="calcPesoObjetivo" type="number" step="0.5" min="0" />
          </div>
        </div>

        <div class="form-row">
          <div class="field">
            <label>Prazo (semanas ‚Äì opcional)</label>
            <input id="calcSemanas" type="number" min="0" />
          </div>
        </div>

        <button class="btn-primary" id="calcBtn">Calcular sugest√£o</button>

        <div id="calcResultado" class="card-compact" style="margin-top:8px;">
          Escolhe o exerc√≠cio, indica o n¬∫ de repeti√ß√µes e define o objetivo (for√ßa, hipertrofia ou t√©cnica). A CrossBox usa o teu 1RM para sugerir peso, volume e progress√£o.
        </div>
      </div>
    </section>

    <!-- GR√ÅFICO 1RM -->
    <section id="opt-graficos" class="option-section">
      <div class="card">
        <h3 style="margin-top:0; margin-bottom:8px;">üìà Gr√°fico de evolu√ß√£o do teu 1RM</h3>
        <div class="field">
          <label>Exerc√≠cio</label>
          <select id="graphExercise"></select>
        </div>
        <div style="margin-top:8px;">
          <canvas id="rmChart" style="width:100%; max-height:260px;"></canvas>
        </div>
      </div>
    </section>

    <!-- PERFORMANCE -->
    <section id="opt-performance" class="option-section">
      <div class="card">
        <h3 style="margin-top:0; margin-bottom:8px;">üèÖ Performance f√≠sica ‚Äì resumo</h3>
        <p class="helper-text">
          Resumo autom√°tico da tua carga de treino, com base nos WOD registados, 1RM e metcons (carga total em kg e dist√¢ncia em km).
        </p>

        <h4 style="margin-top:10px; margin-bottom:4px;">WOD ‚Äì dias com mais carga total</h4>
        <div class="scroll">
          <table>
            <thead>
              <tr>
                <th>Data</th>
                <th>Carga total (kg)</th>
                <th>Dist√¢ncia total (km)</th>
                <th>N.¬∫ exerc√≠cios</th>
                <th>Melhor tempo metcon</th>
              </tr>
            </thead>
            <tbody id="perfWodBody"></tbody>
          </table>
        </div>

        <h4 style="margin-top:12px; margin-bottom:4px;">Top 1RM</h4>
        <div class="scroll">
          <table>
            <thead>
              <tr>
                <th>Exerc√≠cio</th>
                <th>1RM</th>
                <th>Rela√ß√£o 1RM / peso corporal</th>
              </tr>
            </thead>
            <tbody id="perfRmBody"></tbody>
          </table>
        </div>
      </div>
    </section>

    <!-- GUIA DE EXERC√çCIOS -->
    <section id="opt-guia" class="option-section">
      <div class="card">
        <h3 style="margin-top:0; margin-bottom:8px;">üìö Guia de exerc√≠cios e movimentos</h3>
        <input id="guiaSearch" type="text" placeholder="Procurar exerc√≠cio (EN/PT) ou descri√ß√£o..." />
        <div class="scroll" style="margin-top:6px;">
          <table>
            <thead>
              <tr>
                <th>Nome (EN)</th>
                <th>Tradu√ß√£o (PT)</th>
                <th>Descri√ß√£o</th>
              </tr>
            </thead>
            <tbody id="guiaBody"></tbody>
          </table>
        </div>
      </div>
    </section>

    <!-- BACKUP -->
    <section id="opt-backup" class="option-section">
      <div class="card">
        <h3 style="margin-top:0; margin-bottom:8px;">üíæ Backup de dados CrossBox</h3>
        <p class="helper-text">
          Guarda num ficheiro o teu perfil, 1RM, WOD, reservas e restantes dados da CrossBox.
          Podes arquivar em Google Drive, iCloud ou Ficheiros. Para restaurar noutro telem√≥vel, basta importar esse ficheiro.
        </p>
        <div class="form-row">
          <button class="btn-primary" id="exportBackupBtn">Exportar backup</button>
          <button class="btn-secondary" id="importBackupBtn">Importar backup</button>
          <input type="file" id="backupFileInput" accept="application/json" style="display:none;" />
        </div>
        <div id="backupInfo"></div>
      </div>
    </section>

  </section>
  <script>
/* ===== CHAVES DE ARMAZENAMENTO ===== */
const STORAGE_PROFILE = "crossfit_profile";
const STORAGE_RM = "crossfit_1rm";
const STORAGE_RM_HISTORY = "crossfit_1rm_history";
const STORAGE_TREINO = "crossfit_treinos";
const STORAGE_BACKUP_META = "crossfit_backup_meta";

/* NOVOS ARMAZENAMENTOS */
const STORAGE_RESERVAS = "crossfit_reservas";
const STORAGE_PRESENCAS = "crossfit_presencas";
const STORAGE_RANKINGS = "crossfit_rankings";

/* ===== PERFIL ===== */
let profile = JSON.parse(localStorage.getItem(STORAGE_PROFILE) || "{}");

const nomeEl = document.getElementById("nome");
const nivelEl = document.getElementById("nivel");
const sexoEl = document.getElementById("sexo");
const idadeEl = document.getElementById("idade");
const alturaEl = document.getElementById("altura");
const pesoEl = document.getElementById("peso");
const perfilResumoEl = document.getElementById("perfilResumo");
const perfilFormEl = document.getElementById("perfilForm");

/* ===== TABS ===== */
const tabButtons = document.querySelectorAll(".tab-btn");
const sections = document.querySelectorAll(".section");

/* ===== OP√á√ïES (WOD & FERRAMENTAS) ===== */
const optButtons = document.querySelectorAll(".opt-btn");
const optSections = document.querySelectorAll(".option-section");

/* ===== 1RM ===== */
const EXERCISES = [
  "Back Squat",
  "Front Squat",
  "Overhead Squat",
  "Deadlift",
  "Sumo Deadlift",
  "Clean",
  "Power Clean",
  "Hang Power Clean",
  "Squat Clean",
  "Jerk",
  "Split Jerk",
  "Push Jerk",
  "Snatch",
  "Power Snatch",
  "Hang Power Snatch",
  "Squat Snatch",
  "Bench Press",
  "Strict Press",
  "Push Press",
  "Thruster",
  "Clean & Jerk"
];

/* Conjunto alargado para WOD e Guia */
const ALL_EXERCISES = [
  ...EXERCISES,
  "Pull-up",
  "Chest-to-bar Pull-up",
  "Bar Muscle-up",
  "Ring Muscle-up",
  "Toes-to-bar",
  "Kipping Pull-up",
  "Handstand Push-up",
  "Handstand Walk",
  "Wall Walk",
  "Row (cal)",
  "Row (m)",
  "Bike (cal)",
  "Run (m)",
  "Run (km)",
  "Ski (cal)",
  "Double Under",
  "Single Under",
  "Box Jump",
  "Box Jump-over",
  "Burpee",
  "Burpee Box Jump-over",
  "Kettlebell Swing",
  "Kettlebell Snatch",
  "Kettlebell Clean",
  "Dumbbell Snatch",
  "Dumbbell Clean & Jerk",
  "Dumbbell Thruster",
  "Farmer Carry",
  "Yoke Carry",
  "Sandbag Carry",
  "GHD Sit-up",
  "Sit-up",
  "V-up",
  "Russian Twist",
  "Plank",
  "L-sit"
];

/* Tradu√ß√µes EN/PT e descri√ß√µes para o guia */
const EXER_INFO = [
  { en: "Back Squat", pt: "Agachamento com barra nas costas", desc: "Agachamento completo com a barra apoiada na parte superior das costas." },
  { en: "Front Squat", pt: "Agachamento frontal", desc: "Agachamento com a barra apoiada nos ombros √† frente (rack frontal)." },
  { en: "Overhead Squat", pt: "Agachamento overhead", desc: "Agachamento profundo com a barra acima da cabe√ßa, com bra√ßos estendidos." },
  { en: "Deadlift", pt: "Peso morto", desc: "Eleva√ß√£o da barra do ch√£o at√© √† posi√ß√£o de p√©, mantendo a coluna neutra." },
  { en: "Sumo Deadlift", pt: "Peso morto sumo", desc: "Varia√ß√£o com p√©s mais afastados e m√£os em pega estreita." },
  { en: "Clean", pt: "Clean", desc: "Carregamento da barra do ch√£o at√© √† posi√ß√£o de rack frontal num s√≥ movimento." },
  { en: "Power Clean", pt: "Power clean", desc: "Clean apanhado acima da paralela (sem agachamento completo)." },
  { en: "Hang Power Clean", pt: "Hang power clean", desc: "Partida da barra acima dos joelhos (hang), apanhado em power." },
  { en: "Squat Clean", pt: "Clean com agachamento", desc: "Clean apanhado em agachamento completo frontal." },
  { en: "Jerk", pt: "Jerk", desc: "Impulso explosivo da barra desde o rack frontal at√© overhead." },
  { en: "Split Jerk", pt: "Split jerk", desc: "Jerk com rece√ß√£o em posi√ß√£o de lunge (pernas afastadas)." },
  { en: "Push Jerk", pt: "Push jerk", desc: "Jerk com ligeiro agachamento para receber a barra, sem dividir as pernas." },
  { en: "Snatch", pt: "Snatch", desc: "Eleva√ß√£o da barra do ch√£o at√© acima da cabe√ßa num s√≥ movimento." },
  { en: "Power Snatch", pt: "Power snatch", desc: "Snatch apanhado acima da paralela." },
  { en: "Hang Power Snatch", pt: "Hang power snatch", desc: "Snatch a partir da posi√ß√£o acima dos joelhos, apanhado em power." },
  { en: "Squat Snatch", pt: "Snatch com agachamento", desc: "Snatch apanhado em agachamento profundo." },
  { en: "Bench Press", pt: "Supino", desc: "Press deitado no banco com a barra ao longo do peito." },
  { en: "Strict Press", pt: "Press militar estrito", desc: "Press√£o da barra acima da cabe√ßa sem ajuda de pernas." },
  { en: "Push Press", pt: "Push press", desc: "Press√£o overhead com ligeira ajuda de pernas." },
  { en: "Thruster", pt: "Thruster", desc: "Agachamento frontal seguido de press overhead num s√≥ movimento fluido." },
  { en: "Clean & Jerk", pt: "Clean & Jerk", desc: "Combina√ß√£o de clean seguido de jerk." },
  { en: "Pull-up", pt: "Eleva√ß√£o na barra", desc: "Subida da queixo √† barra com pega pronada." },
  { en: "Chest-to-bar Pull-up", pt: "Pull-up peito √† barra", desc: "Pull-up em que o peito toca na barra." },
  { en: "Bar Muscle-up", pt: "Muscle-up na barra", desc: "Transi√ß√£o de pendurado para suporte em cima da barra." },
  { en: "Ring Muscle-up", pt: "Muscle-up nos an√©is", desc: "Muscle-up executado em an√©is de gin√°stica." },
  { en: "Toes-to-bar", pt: "Toes-to-bar", desc: "Eleva√ß√£o das pernas at√© tocar a barra com os p√©s." },
  { en: "Kipping Pull-up", pt: "Pull-up com kipping", desc: "Pull-up com balan√ßo c√≠clico para ganhar impulso." },
  { en: "Handstand Push-up", pt: "Flex√£o de bra√ßo em pino", desc: "Flex√£o em pino, com apoio nas m√£os." },
  { en: "Handstand Walk", pt: "Caminhada em pino", desc: "Desloca√ß√£o em pino sobre as m√£os." },
  { en: "Wall Walk", pt: "Wall walk", desc: "Subida do corpo at√© posi√ß√£o de pino com os p√©s na parede." },
  { en: "Row (cal)", pt: "Remo (calorias)", desc: "Remo em m√°quina contabilizando calorias." },
  { en: "Row (m)", pt: "Remo (metros)", desc: "Remo em m√°quina contabilizando dist√¢ncia." },
  { en: "Bike (cal)", pt: "Bicicleta (calorias)", desc: "Trabalho em bicicleta ergom√©trica em calorias." },
  { en: "Run (m)", pt: "Corrida (metros)", desc: "Corrida com dist√¢ncia medida em metros." },
  { en: "Run (km)", pt: "Corrida (quil√≥metros)", desc: "Corrida com dist√¢ncia medida em quil√≥metros." },
  { en: "Ski (cal)", pt: "Ski erg (calorias)", desc: "Trabalho em ski erg√≥metro em calorias." },
  { en: "Double Under", pt: "Duplo salto √† corda", desc: "Salto em que a corda passa duas vezes debaixo dos p√©s." },
  { en: "Single Under", pt: "Salto simples √† corda", desc: "Salto em que a corda passa uma vez debaixo dos p√©s." },
  { en: "Box Jump", pt: "Salto para a caixa", desc: "Salto bilateral para cima de uma caixa." },
  { en: "Box Jump-over", pt: "Salto por cima da caixa", desc: "Salto passando completamente por cima da caixa." },
  { en: "Burpee", pt: "Burpee", desc: "Movimento completo com descida ao ch√£o e salto." },
  { en: "Burpee Box Jump-over", pt: "Burpee + salto caixa", desc: "Burpee seguido de salto por cima da caixa." },
  { en: "Kettlebell Swing", pt: "Swing com kettlebell", desc: "Balan√ßo da kettlebell entre as pernas at√© √† frente." },
  { en: "Kettlebell Snatch", pt: "Snatch com kettlebell", desc: "Levantamento da kettlebell at√© overhead num s√≥ movimento." },
  { en: "Kettlebell Clean", pt: "Clean com kettlebell", desc: "Carregamento da kettlebell at√© posi√ß√£o de rack." },
  { en: "Dumbbell Snatch", pt: "Snatch com haltere", desc: "Snatch unilateral com haltere." },
  { en: "Dumbbell Clean & Jerk", pt: "Clean & Jerk com halteres", desc: "Clean & jerk com halteres, normalmente unilateral ou alternado." },
  { en: "Dumbbell Thruster", pt: "Thruster com halteres", desc: "Agachamento frontal + press overhead com halteres." },
  { en: "Farmer Carry", pt: "Farmer carry", desc: "Caminhada com cargas nas m√£os, estilo \"farmer\"." },
  { en: "Yoke Carry", pt: "Transporte de yoke", desc: "Transporte de estrutura pesada (yoke) aos ombros." },
  { en: "Sandbag Carry", pt: "Transporte de saco de areia", desc: "Caminhada com saco de areia em diferentes posi√ß√µes." },
  { en: "GHD Sit-up", pt: "Abdominais GHD", desc: "Sit-up em m√°quina GHD, com grande amplitude de movimento." },
  { en: "Sit-up", pt: "Abdominais tradicionais", desc: "Abdominais no ch√£o, com flex√£o do tronco." },
  { en: "V-up", pt: "V-ups", desc: "Abdominais com eleva√ß√£o simult√¢nea de tronco e pernas, formando um \"V\"." },
  { en: "Russian Twist", pt: "Russian twist", desc: "Rota√ß√£o do tronco com ou sem carga, sentado." },
  { en: "Plank", pt: "Prancha", desc: "Manuten√ß√£o da posi√ß√£o de prancha, isometria de core." },
  { en: "L-sit", pt: "L-sit", desc: "Posi√ß√£o em \"L\" sustentada, com pernas estendidas." }
];

const MOVES = EXERCISES.slice();
const MOVES_PT = {};
EXER_INFO.forEach(ex => {
  MOVES_PT[ex.en] = ex.pt;
});

const PERC = [
  0.25, 0.30, 0.35, 0.40,
  0.50, 0.60, 0.65, 0.70,
  0.75, 0.80, 0.85, 0.90,
  0.95
];

let dataRm = JSON.parse(localStorage.getItem(STORAGE_RM) || "{}");
let rmHistory = JSON.parse(localStorage.getItem(STORAGE_RM_HISTORY) || "{}");

const sel = document.getElementById("exercise");
const rm = document.getElementById("oneRm");
const bodyTable = document.getElementById("tableBody");

/* WOD */
let treinos = JSON.parse(localStorage.getItem(STORAGE_TREINO) || "[]");

const treinoDataEl = document.getElementById("treinoData");
const treinoExEl = document.getElementById("treinoExercicio");
const treinoExSearchEl = document.getElementById("treinoExercicioSearch");
const treinoTipoEl = document.getElementById("treinoTipo");
const treinoRondasEl = document.getElementById("treinoRondas");
const treinoRepsEl = document.getElementById("treinoReps");
const treinoPesoEl = document.getElementById("treinoPeso");
const treinoTempoEl = document.getElementById("treinoTempo");
const treinoDistEl = document.getElementById("treinoDist");
const treinoAddBtn = document.getElementById("treinoAdd");
const treinoBodyEl = document.getElementById("treinoBody");

/* Reservas */
const reservaDataEl = document.getElementById("reservaData");
const reservaHoraEl = document.getElementById("reservaHora");
const reservaTipoEl = document.getElementById("reservaTipo");
const reservaNotaEl = document.getElementById("reservaNota");
const reservaAddBtn = document.getElementById("reservaAddBtn");
const reservasBodyEl = document.getElementById("reservasBody");
const reservasResumoEl = document.getElementById("reservasResumo");

let reservas = JSON.parse(localStorage.getItem(STORAGE_RESERVAS) || "[]");
let presencas = JSON.parse(localStorage.getItem(STORAGE_PRESENCAS) || "[]");
let rankingsMensais = JSON.parse(localStorage.getItem(STORAGE_RANKINGS) || "[]");

function formatKg(v) {
  return v.toFixed(1).replace(".", ",") + " kg";
}

function formatKm(v) {
  return v.toFixed(2).replace(".", ",") + " km";
}

/* Selects ‚Äì 1RM com MOVES; WOD com ALL_EXERCISES */
function updateTreinoExercicioOptions(filter) {
  if (!treinoExEl) return;
  const f = (filter || "").toLowerCase();
  treinoExEl.innerHTML = "";
  ALL_EXERCISES.forEach(m => {
    const label = MOVES_PT[m] ? `${m} ‚Äì ${MOVES_PT[m]}` : m;
    if (f && !label.toLowerCase().includes(f)) return;
    const opt = document.createElement("option");
    opt.value = m;
    opt.textContent = label;
    treinoExEl.appendChild(opt);
  });
}

function initSelects() {
  if (sel) {
    sel.innerHTML = "";
    MOVES.forEach(m => {
      const opt = document.createElement("option");
      opt.value = m;
      opt.textContent = MOVES_PT[m] ? `${m} ‚Äì ${MOVES_PT[m]}` : m;
      sel.appendChild(opt);
    });
  }

  if (treinoExEl) {
    updateTreinoExercicioOptions("");
  }

  const calcEx = document.getElementById("calcExercicio");
  if (calcEx) {
    calcEx.innerHTML = "";
    MOVES.forEach(m => {
      const opt = document.createElement("option");
      opt.value = m;
      opt.textContent = MOVES_PT[m] ? `${m} ‚Äì ${MOVES_PT[m]}` : m;
      calcEx.appendChild(opt);
    });
  }

  const graphEx = document.getElementById("graphExercise");
  if (graphEx) {
    graphEx.innerHTML = "";
    MOVES.forEach(m => {
      const opt = document.createElement("option");
      opt.value = m;
      opt.textContent = MOVES_PT[m] ? `${m} ‚Äì ${MOVES_PT[m]}` : m;
      graphEx.appendChild(opt);
    });
  }

  const guiaBody = document.getElementById("guiaBody");
  if (guiaBody) {
    guiaBody.innerHTML = "";
    EXER_INFO.forEach(ex => {
      const tr = document.createElement("tr");
      const tdEn = document.createElement("td");
      const tdPt = document.createElement("td");
      const tdDesc = document.createElement("td");

      tdEn.textContent = ex.en;
      tdPt.textContent = ex.pt;
      tdDesc.textContent = ex.desc;

      tr.appendChild(tdEn);
      tr.appendChild(tdPt);
      tr.appendChild(tdDesc);
      guiaBody.appendChild(tr);
    });
  }

  const guiaSearch = document.getElementById("guiaSearch");
  if (guiaSearch) {
    guiaSearch.addEventListener("input", () => {
      const term = guiaSearch.value.toLowerCase();
      const rows = guiaBody.querySelectorAll("tr");
      rows.forEach(row => {
        const text = row.textContent.toLowerCase();
        row.style.display = text.includes(term) ? "" : "none";
      });
    });
  }
}

function updatePerfilFormFromProfile() {
  if (!profile) return;
  if (nomeEl) nomeEl.value = profile.nome || "";
  if (nivelEl) nivelEl.value = profile.nivel || "";
  if (sexoEl) sexoEl.value = profile.sexo || "";
  if (idadeEl) idadeEl.value = profile.idade || "";
  if (alturaEl) alturaEl.value = profile.altura || "";
  if (pesoEl) pesoEl.value = profile.peso || "";
}

function updatePerfilResumo() {
  if (!perfilResumoEl) return;
  if (!profile || !profile.nome) {
    perfilResumoEl.textContent = "Perfil n√£o definido.";
    const sub = document.getElementById("appSubtitle");
    if (sub) {
      sub.textContent = "Toca aqui para configurar o teu perfil na CrossBox";
    }
    return;
  }

  const parts = [];
  parts.push(profile.nome);
  if (profile.nivel) parts.push(profile.nivel);
  if (profile.sexo) parts.push(profile.sexo);
  if (profile.idade) parts.push(profile.idade + " anos");
  if (profile.altura) parts.push(profile.altura + " cm");
  if (profile.peso) parts.push(profile.peso + " kg");

  perfilResumoEl.textContent = parts.join(" ¬∑ ");

  const sub = document.getElementById("appSubtitle");
  if (sub) {
    sub.textContent = `Registo de treinos de ${profile.nome}`;
  }
}

if (perfilResumoEl) {
  perfilResumoEl.addEventListener("click", () => {
    if (!perfilFormEl) return;
    const isVisible = perfilFormEl.style.display === "block";
    perfilFormEl.style.display = isVisible ? "none" : "block";
  });
}

/* ===== EVENTO BOT√ÉO PERFIL ===== */
const saveProfileBtn = document.getElementById("saveProfile");
if (saveProfileBtn) {
  saveProfileBtn.addEventListener("click", () => {
    profile = {
      nome: nomeEl.value.trim(),
      nivel: nivelEl.value,
      sexo: sexoEl.value,
      idade: idadeEl.value,
      altura: alturaEl.value,
      peso: parseFloat(pesoEl.value || "0") || ""
    };
    localStorage.setItem(STORAGE_PROFILE, JSON.stringify(profile));
    updatePerfilResumo();
    alert("Perfil atualizado com sucesso.");
  });
}

/* ===== 1RM ‚Äì GUARDAR E LISTAR ===== */
function saveOneRm() {
  if (!sel || !rm) return;
  const ex = sel.value;
  const val = parseFloat(rm.value || "0");
  if (!ex || !val) return;

  if (!rmHistory[ex]) rmHistory[ex] = [];
  if (dataRm[ex]) {
    rmHistory[ex].push({
      date: new Date().toISOString(),
      value: dataRm[ex]
    });
  }

  dataRm[ex] = val;
  localStorage.setItem(STORAGE_RM, JSON.stringify(dataRm));
  localStorage.setItem(STORAGE_RM_HISTORY, JSON.stringify(rmHistory));

  rm.value = "";
  sel.value = ex;
  renderTable();
  renderPerformanceRm();
  updateGraphExerciseOptions();
}

function renderTable() {
  if (!bodyTable) return;
  bodyTable.innerHTML = "";
  const entries = Object.entries(dataRm).sort(([a], [b]) => a.localeCompare(b));

  entries.forEach(([name, value]) => {
    const tr = document.createElement("tr");

    const tdName = document.createElement("td");
    tdName.textContent = MOVES_PT[name] ? `${name} ‚Äì ${MOVES_PT[name]}` : name;
    tr.appendChild(tdName);

    const td1rm = document.createElement("td");
    let oneRmText = formatKg(dataRm[name]);

    if (profile && profile.peso) {
      const rel = dataRm[name] / profile.peso;
      oneRmText += " (" + rel.toFixed(2) + "x peso corporal)";
    }

    const histList = rmHistory[name] || [];
    if (histList.length) {
      const prev = histList[histList.length - 1];
      const prevVal = prev.value;
      const diff = dataRm[name] - prevVal;
      if (Math.abs(diff) >= 0.5) {
        const seta = diff > 0 ? "‚Üë" : "‚Üì";
        const diffAbs = Math.abs(diff).toFixed(1).replace(".", ",");
        oneRmText += ` ¬∑ ${seta} ${diffAbs} kg vs anterior`;
      }
    }

    td1rm.textContent = oneRmText;
    tr.appendChild(td1rm);

    PERC.forEach(p => {
      const td = document.createElement("td");
      td.textContent = formatKg(dataRm[name] * p);
      tr.appendChild(td);
    });

    const tdDelete = document.createElement("td");
    const btn = document.createElement("button");
    btn.textContent = "X";
    btn.className = "btn-danger";
    btn.addEventListener("click", () => {
      delete dataRm[name];
      localStorage.setItem(STORAGE_RM, JSON.stringify(dataRm));
      renderTable();
      renderPerformanceRm();
      updateGraphExerciseOptions();
    });
    tdDelete.appendChild(btn);
    tr.appendChild(tdDelete);

    bodyTable.appendChild(tr);
  });
}

/* ===== TABS PRINCIPAIS ===== */
tabButtons.forEach(btn => {
  btn.addEventListener("click", () => {
    const target = btn.getAttribute("data-target");
    tabButtons.forEach(b => b.classList.remove("active"));
    sections.forEach(sec => sec.classList.remove("active"));

    btn.classList.add("active");
    const sec = document.getElementById(target);
    if (sec) sec.classList.add("active");
  });
});

/* ===== OP√á√ïES (WOD & TOOLS) ===== */
optButtons.forEach(btn => {
  btn.addEventListener("click", () => {
    const target = btn.getAttribute("data-target");
    optButtons.forEach(b => b.classList.remove("active"));
    optSections.forEach(sec => sec.classList.remove("active"));

    btn.classList.add("active");
    const sec = document.getElementById(target);
    if (sec) sec.classList.add("active");
  });
});

/* ===== WOD ===== */
if (treinoExSearchEl) {
  treinoExSearchEl.addEventListener("input", () => {
    const filter = treinoExSearchEl.value;
    updateTreinoExercicioOptions(filter);
  });
}

function loadTreinos() {
  treinos = JSON.parse(localStorage.getItem(STORAGE_TREINO) || "[]");
}

function saveTreinos() {
  localStorage.setItem(STORAGE_TREINO, JSON.stringify(treinos));
}

function renderTreinos() {
  if (!treinoBodyEl) return;
  treinoBodyEl.innerHTML = "";

  const sorted = [...treinos].sort((a, b) => {
    if (a.data === b.data) {
      return (b.createdAt || "").localeCompare(a.createdAt || "");
    }
    return b.data.localeCompare(a.data);
  });

  sorted.forEach((t, idx) => {
    const tr = document.createElement("tr");

    const tdData = document.createElement("td");
    tdData.textContent = t.data;
    tr.appendChild(tdData);

    const tdEx = document.createElement("td");
    tdEx.textContent = t.exercicio;
    tr.appendChild(tdEx);

    const tdTipo = document.createElement("td");
    tdTipo.textContent = t.tipo || "";
    tr.appendChild(tdTipo);

    const tdRondas = document.createElement("td");
    tdRondas.textContent = t.rondas || "";
    tr.appendChild(tdRondas);

    const tdReps = document.createElement("td");
    tdReps.textContent = t.reps || "";
    tr.appendChild(tdReps);

    const tdPeso = document.createElement("td");
    tdPeso.textContent = t.peso ? formatKg(t.peso) : "";
    tr.appendChild(tdPeso);

    const tdTempo = document.createElement("td");
    tdTempo.textContent = t.tempo || "";
    tr.appendChild(tdTempo);

    const tdDist = document.createElement("td");
    tdDist.textContent = t.dist ? formatKm(t.dist) : "";
    tr.appendChild(tdDist);

    const tdDel = document.createElement("td");
    const btn = document.createElement("button");
    btn.className = "btn-danger";
    btn.textContent = "X";
    btn.addEventListener("click", () => {
      const indexInTreinos = treinos.findIndex(
        original => original.data === t.data &&
          original.exercicio === t.exercicio &&
          original.createdAt === t.createdAt
      );
      if (indexInTreinos !== -1) {
        treinos.splice(indexInTreinos, 1);
        saveTreinos();
        renderTreinos();
        renderPerformanceWod();
      }
    });
    tdDel.appendChild(btn);
    tr.appendChild(tdDel);

    treinoBodyEl.appendChild(tr);
  });
}

function addTreino() {
  if (!treinoDataEl || !treinoExEl) return;
  const data = treinoDataEl.value;
  const exercicio = treinoExEl.value;
  const tipo = treinoTipoEl ? treinoTipoEl.value : "";
  const rondas = treinoRondasEl ? parseInt(treinoRondasEl.value || "0", 10) : 0;
  const reps = treinoRepsEl ? parseInt(treinoRepsEl.value || "0", 10) : 0;
  const peso = treinoPesoEl ? parseFloat(treinoPesoEl.value || "0") : 0;
  const tempo = treinoTempoEl ? treinoTempoEl.value.trim() : "";
  const dist = treinoDistEl ? parseFloat(treinoDistEl.value || "0") : 0;

  if (!data || !exercicio) return;

  const novoTreino = {
    data,
    exercicio,
    tipo,
    rondas,
    reps,
    peso,
    tempo,
    dist,
    createdAt: new Date().toISOString()
  };

  treinos.push(novoTreino);
  saveTreinos();
  renderTreinos();
  renderPerformanceWod();

  if (treinoRondasEl) treinoRondasEl.value = "";
  if (treinoRepsEl) treinoRepsEl.value = "";
  if (treinoPesoEl) treinoPesoEl.value = "";
  if (treinoTempoEl) treinoTempoEl.value = "";
  if (treinoDistEl) treinoDistEl.value = "";
}

if (treinoAddBtn) {
  treinoAddBtn.addEventListener("click", addTreino);
}

/* ===== RESERVAS & PRESEN√áAS ===== */
function saveReservas() {
  localStorage.setItem(STORAGE_RESERVAS, JSON.stringify(reservas));
}

function renderReservas() {
  if (!reservasBodyEl) return;
  reservasBodyEl.innerHTML = "";

  const sorted = [...reservas].sort((a, b) => {
    if (a.data === b.data) {
      return (a.hora || "").localeCompare(b.hora || "");
    }
    return a.data.localeCompare(b.data);
  });

  sorted.forEach((r, idx) => {
    const tr = document.createElement("tr");

    const tdData = document.createElement("td");
    tdData.textContent = r.data || "";
    tr.appendChild(tdData);

    const tdHora = document.createElement("td");
    tdHora.textContent = r.hora || "";
    tr.appendChild(tdHora);

    const tdTipo = document.createElement("td");
    tdTipo.textContent = r.tipo || "";
    tr.appendChild(tdTipo);

    const tdNota = document.createElement("td");
    tdNota.textContent = r.nota || "";
    tr.appendChild(tdNota);

    const tdPresenca = document.createElement("td");
    const check = document.createElement("input");
    check.type = "checkbox";
    check.checked = !!r.presente;
    check.addEventListener("change", () => {
      reservas[idx].presente = check.checked;
      saveReservas();
      renderReservasResumo();
    });
    tdPresenca.appendChild(check);
    tr.appendChild(tdPresenca);

    const tdDel = document.createElement("td");
    const btn = document.createElement("button");
    btn.className = "btn-danger";
    btn.textContent = "X";
    btn.addEventListener("click", () => {
      reservas.splice(idx, 1);
      saveReservas();
      renderReservas();
      renderReservasResumo();
    });
    tdDel.appendChild(btn);
    tr.appendChild(tdDel);

    reservasBodyEl.appendChild(tr);
  });
}

function renderReservasResumo() {
  if (!reservasResumoEl) return;
  const now = new Date();
  const month = now.getMonth();
  const year = now.getFullYear();

  let nReservasMes = 0;
  let nPresencasMes = 0;

  reservas.forEach(r => {
    if (!r.data) return;
    const d = new Date(r.data);
    if (d.getFullYear() === year && d.getMonth() === month) {
      nReservasMes++;
      if (r.presente) nPresencasMes++;
    }
  });

  let texto = `Este m√™s tens ${nReservasMes} reservas e ${nPresencasMes} presen√ßas registadas.`;

  const rank = calcularRankingsMensais();
  if (rank && rank.totalKg && rank.nTreinos) {
    texto += ` Carga total em WOD: ${formatKg(rank.totalKg)} em ${rank.nTreinos} treinos.`;
  } else {
    texto += " Ainda n√£o h√° dados suficientes de WOD para criar um resumo mensal de carga.";
  }

  reservasResumoEl.textContent = texto;
}

function addReserva() {
  if (!reservaDataEl || !reservaHoraEl || !reservaTipoEl) return;
  const data = reservaDataEl.value;
  const hora = reservaHoraEl.value;
  const tipo = reservaTipoEl.value;
  const nota = reservaNotaEl ? reservaNotaEl.value.trim() : "";

  if (!data || !hora || !tipo) {
    alert("Para registar a reserva, indica a data, a hora e o tipo de aula.");
    return;
  }

  reservas.push({
    data,
    hora,
    tipo,
    nota,
    presente: false
  });

  saveReservas();
  renderReservas();
  renderReservasResumo();

  reservaDataEl.value = "";
  reservaHoraEl.value = "";
  reservaTipoEl.value = "";
  if (reservaNotaEl) reservaNotaEl.value = "";
}

if (reservaAddBtn) {
  reservaAddBtn.addEventListener("click", addReserva);
}

/* ===== PERFORMANCE ‚Äì RESUMO DE CARGA E 1RM ===== */
const perfWodBody = document.getElementById("perfWodBody");
const perfRmBody = document.getElementById("perfRmBody");

function renderPerformanceWod() {
  if (!perfWodBody) return;
  perfWodBody.innerHTML = "";

  const mapDia = {};

  treinos.forEach(t => {
    const key = t.data;
    if (!key) return;
    if (!mapDia[key]) {
      mapDia[key] = {
        data: key,
        totalKg: 0,
        totalKm: 0,
        nEx: 0,
        melhorTempoMetcon: null
      };
    }
    const entry = mapDia[key];

    const reps = t.rondas * t.reps || 0;
    if (t.peso && reps) {
      entry.totalKg += t.peso * reps;
    }

    if (t.dist) {
      entry.totalKm += t.dist;
    }

    entry.nEx += 1;

    if (t.tipo === "metcon" && t.tempo) {
      const secs = parseTempoToSeconds(t.tempo);
      if (!isNaN(secs)) {
        if (entry.melhorTempoMetcon === null || secs < entry.melhorTempoMetcon) {
          entry.melhorTempoMetcon = secs;
        }
      }
    }
  });

  const arr = Object.values(mapDia).sort((a, b) => b.totalKg - a.totalKg);

  arr.forEach(d => {
    const tr = document.createElement("tr");

    const tdData = document.createElement("td");
    tdData.textContent = d.data;
    tr.appendChild(tdData);

    const tdKg = document.createElement("td");
    tdKg.textContent = d.totalKg ? formatKg(d.totalKg) : "";
    tr.appendChild(tdKg);

    const tdKm = document.createElement("td");
    tdKm.textContent = d.totalKm ? formatKm(d.totalKm) : "";
    tr.appendChild(tdKm);

    const tdNEx = document.createElement("td");
    tdNEx.textContent = d.nEx;
    tr.appendChild(tdNEx);

    const tdTempo = document.createElement("td");
    tdTempo.textContent = d.melhorTempoMetcon !== null
      ? secondsToTimeString(d.melhorTempoMetcon)
      : "";
    tr.appendChild(tdTempo);

    perfWodBody.appendChild(tr);
  });
}

function renderPerformanceRm() {
  if (!perfRmBody) return;
  perfRmBody.innerHTML = "";

  const entries = Object.entries(dataRm).sort((a, b) => b[1] - a[1]);

  entries.forEach(([ex, val]) => {
    const tr = document.createElement("tr");

    const tdEx = document.createElement("td");
    tdEx.textContent = MOVES_PT[ex] ? `${ex} ‚Äì ${MOVES_PT[ex]}` : ex;
    tr.appendChild(tdEx);

    const tdVal = document.createElement("td");
    tdVal.textContent = formatKg(val);
    tr.appendChild(tdVal);

    const tdRel = document.createElement("td");
    if (profile && profile.peso) {
      const rel = val / profile.peso;
      tdRel.textContent = rel.toFixed(2) + "x peso corporal";
    } else {
      tdRel.textContent = "‚Äî";
    }
    tr.appendChild(tdRel);

    perfRmBody.appendChild(tr);
  });
}

/* Fun√ß√µes de tempo para metcons */
function parseTempoToSeconds(str) {
  if (!str) return NaN;
  str = str.trim();

  if (/^\d{1,2}:\d{2}$/.test(str)) {
    const [mm, ss] = str.split(":").map(Number);
    return mm * 60 + ss;
  }

  if (/^\d{1,2}:\d{2}:\d{2}$/.test(str)) {
    const [hh, mm, ss] = str.split(":").map(Number);
    return hh * 3600 + mm * 60 + ss;
  }

  return NaN;
}

function secondsToTimeString(sec) {
  const ss = sec % 60;
  const mm = Math.floor(sec / 60) % 60;
  const hh = Math.floor(sec / 3600);
  if (hh > 0) {
    return `${String(hh).padStart(2, "0")}:${String(mm).padStart(2, "0")}:${String(ss).padStart(2, "0")}`;
  }
  return `${String(mm).padStart(2, "0")}:${String(ss).padStart(2, "0")}`;
}

/* ===== CALCULADORA DE OBJETIVO ===== */
const calcBtn = document.getElementById("calcBtn");
const calcExEl = document.getElementById("calcExercicio");
const calcRepsEl = document.getElementById("calcReps");
const calcObjEl = document.getElementById("calcObjetivo");
const calcTargetKgEl = document.getElementById("calcPesoObjetivo");
const calcWeeksEl = document.getElementById("calcSemanas");
const calcResEl = document.getElementById("calcResultado");

function guessIntensityPercent(reps, obj) {
  if (!reps || reps <= 0) return null;
  let minP = 0.5;
  let maxP = 0.9;

  if (obj === "for√ßa") {
    minP = 0.75;
    maxP = 0.95;
  } else if (obj === "hipertrofia") {
    minP = 0.6;
    maxP = 0.8;
  } else if (obj === "t√©cnica") {
    minP = 0.4;
    maxP = 0.7;
  }

  if (reps >= 1 && reps <= 3) {
    minP = Math.max(minP, 0.85);
    maxP = 0.97;
  } else if (reps <= 5) {
    minP = Math.max(minP, 0.8);
    maxP = 0.9;
  } else if (reps <= 8) {
    minP = Math.max(minP, 0.7);
    maxP = 0.85;
  } else if (reps <= 12) {
    minP = Math.max(minP, 0.6);
    maxP = 0.75;
  } else {
    minP = 0.5;
    maxP = Math.min(maxP, 0.7);
  }

  return { minP, maxP };
}

if (calcBtn) {
  calcBtn.addEventListener("click", () => {
    if (!calcExEl || !calcRepsEl || !calcResEl) return;

    const ex = calcExEl.value;
    const reps = parseInt(calcRepsEl.value || "0", 10);
    const obj = calcObjEl ? calcObjEl.value : "";
    const targetKgVal = calcTargetKgEl ? parseFloat(calcTargetKgEl.value || "0") : 0;
    const weeksVal = calcWeeksEl ? parseInt(calcWeeksEl.value || "0", 10) : 0;

    if (!ex) {
      calcResEl.textContent = "Escolhe o exerc√≠cio que queres trabalhar.";
      return;
    }
    if (!reps) {
      calcResEl.textContent = "Indica o n√∫mero de repeti√ß√µes planeadas.";
      return;
    }

    const oneRmVal = dataRm[ex];
    if (!oneRmVal) {
      calcResEl.textContent = "Ainda n√£o tens 1RM registado para esse exerc√≠cio. Guarda primeiro o teu 1RM em cima.";
      return;
    }

    const { minP, maxP } = guessIntensityPercent(reps, obj) || {};
    if (!minP || !maxP) {
      calcResEl.textContent = "N√£o foi poss√≠vel definir uma zona de intensidade. Ajusta o n√∫mero de repeti√ß√µes.";
      return;
    }

    const minKg = oneRmVal * minP;
    const maxKg = oneRmVal * maxP;

    const targetStr = targetKgVal
      ? `Objetivo de carga: cerca de ${formatKg(targetKgVal)}. `
      : "";

    const weeksStr = weeksVal
      ? `Prazo estimado: ${weeksVal} semana(s). Foca-te em progress√£o gradual de carga ou volume, evitando falhas t√©cnicas. `
      : "";

    const zonaObj = obj
      ? `Zona sugerida para ${obj}: entre ${formatKg(minKg)} e ${formatKg(maxKg)}. `
      : `Zona sugerida de trabalho: entre ${formatKg(minKg)} e ${formatKg(maxKg)}. `;

    const recomendacao = `Baseado no teu 1RM atual para ${ex}, ${zonaObj}${targetStr}${weeksStr}Ajusta sempre em fun√ß√£o da tua recupera√ß√£o e t√©cnica.`;

    calcResEl.textContent = recomendacao;
  });
}

/* ===== GR√ÅFICO 1RM ===== */
let rmChart = null;

function updateGraphExerciseOptions() {
  const graphEx = document.getElementById("graphExercise");
  if (!graphEx) return;
  const current = graphEx.value;
  graphEx.innerHTML = "";

  const keys = Object.keys(dataRm).sort();
  keys.forEach(k => {
    const opt = document.createElement("option");
    opt.value = k;
    opt.textContent = MOVES_PT[k] ? `${k} ‚Äì ${MOVES_PT[k]}` : k;
    graphEx.appendChild(opt);
  });

  if (current && keys.includes(current)) {
    graphEx.value = current;
  }

  updateRmChart();
}

function updateRmChart() {
  const graphEx = document.getElementById("graphExercise");
  if (!graphEx) return;
  const ex = graphEx.value;
  const ctx = document.getElementById("rmChart");
  if (!ctx || !ex) return;

  const history = rmHistory[ex] || [];
  const labels = history.map(h => (h.date || "").slice(0, 10));
  const values = history.map(h => h.value);

  const latest = dataRm[ex];
  if (latest) {
    labels.push("Atual");
    values.push(latest);
  }

  if (rmChart) {
    rmChart.destroy();
  }

  const datasetLabel = MOVES_PT[ex] ? `${ex} ‚Äì ${MOVES_PT[ex]} ‚Äì 1RM (kg)` : ex + " ‚Äì 1RM (kg)";

  rmChart = new Chart(ctx, {
    type: "line",
    data: {
      labels,
      datasets: [
        {
          label: datasetLabel,
          data: values,
          fill: false,
          tension: 0.2
        }
      ]
    },
    options: {
      responsive: true,
      maintainAspectRatio: false,
      plugins: {
        legend: {
          labels: {
            font: {
              size: 10
            }
          }
        }
      },
      scales: {
        x: {
          ticks: {
            font: {
              size: 9
            }
          }
        },
        y: {
          ticks: {
            font: {
              size: 9
            }
          }
        }
      }
    }
  });
}

const graphExerciseEl = document.getElementById("graphExercise");
if (graphExerciseEl) {
  graphExerciseEl.addEventListener("change", updateRmChart);
}

/* ===== BACKUP ===== */
const exportBackupBtn = document.getElementById("exportBackupBtn");
const importBackupBtn = document.getElementById("importBackupBtn");
const backupFileInput = document.getElementById("backupFileInput");
const backupInfoEl = document.getElementById("backupInfo");

function getBackupData() {
  return {
    version: 2,
    app: "CrossBox",
    profile,
    dataRm,
    rmHistory,
    treinos,
    reservas,
    presencas,
    rankingsMensais,
    meta: {
      createdAt: new Date().toISOString(),
      userAgent: navigator.userAgent || ""
    }
  };
}

function registerBackupMeta(label) {
  const meta = JSON.parse(localStorage.getItem(STORAGE_BACKUP_META) || "[]");
  meta.push({
    label,
    date: new Date().toISOString()
  });
  localStorage.setItem(STORAGE_BACKUP_META, JSON.stringify(meta));
}

function renderBackupInfo() {
  if (!backupInfoEl) return;
  const meta = JSON.parse(localStorage.getItem(STORAGE_BACKUP_META) || "[]");
  if (!meta.length) {
    backupInfoEl.innerHTML = "<small>Ainda n√£o tens backups registados.</small>";
    return;
  }
  const ul = document.createElement("ul");
  ul.className = "history-list";
  meta.forEach(m => {
    const li = document.createElement("li");
    li.textContent = `${m.label} em ${m.date}`;
    ul.appendChild(li);
  });
  backupInfoEl.innerHTML = "";
  backupInfoEl.appendChild(ul);
}

if (exportBackupBtn) {
  exportBackupBtn.addEventListener("click", () => {
    const data = getBackupData();
    const json = JSON.stringify(data, null, 2);
    const blob = new Blob([json], { type: "application/json" });
    const url = URL.createObjectURL(blob);

    const a = document.createElement("a");
    a.href = url;
    const dateStr = new Date().toISOString().slice(0, 10);
    a.download = `crossbox_backup_${dateStr}.json`;
    a.click();
    URL.revokeObjectURL(url);

    registerBackupMeta("Backup exportado");
    renderBackupInfo();
    alert("Backup criado com sucesso. Guarda o ficheiro em Google Drive, iCloud ou Ficheiros para manteres os teus dados em seguran√ßa.");
  });
}

if (importBackupBtn && backupFileInput) {
  importBackupBtn.addEventListener("click", () => {
    backupFileInput.value = "";
    backupFileInput.click();
  });

  backupFileInput.addEventListener("change", () => {
    const file = backupFileInput.files[0];
    if (!file) return;

    const reader = new FileReader();
    reader.onload = e => {
      try {
        const data = JSON.parse(e.target.result);
        if (!data || typeof data !== "object") {
          alert("Ficheiro inv√°lido. Escolhe um ficheiro de backup da CrossBox.");
          return;
        }
        if (data.app !== "CrossBox") {
          alert("Este ficheiro n√£o parece ser um backup da CrossBox.");
          return;
        }

        profile = data.profile || {};
        dataRm = data.dataRm || {};
        rmHistory = data.rmHistory || {};
        treinos = data.treinos || [];
        reservas = data.reservas || [];
        presencas = data.presencas || [];
        rankingsMensais = data.rankingsMensais || [];

        localStorage.setItem(STORAGE_PROFILE, JSON.stringify(profile));
        localStorage.setItem(STORAGE_RM, JSON.stringify(dataRm));
        localStorage.setItem(STORAGE_RM_HISTORY, JSON.stringify(rmHistory));
        localStorage.setItem(STORAGE_TREINO, JSON.stringify(treinos));
        localStorage.setItem(STORAGE_RESERVAS, JSON.stringify(reservas));
        localStorage.setItem(STORAGE_PRESENCAS, JSON.stringify(presencas));
        localStorage.setItem(STORAGE_RANKINGS, JSON.stringify(rankingsMensais));

        updatePerfilFormFromProfile();
        updatePerfilResumo();
        renderTable();
        renderTreinos();
        renderReservas();
        renderReservasResumo();
        renderPerformanceWod();
        renderPerformanceRm();
        updateGraphExerciseOptions();

        registerBackupMeta("Backup importado");
        renderBackupInfo();
        alert("Backup importado com sucesso. Os teus dados foram atualizados.");
      } catch (err) {
        console.error(err);
        alert("Ocorreu um erro ao ler o ficheiro de backup. Tenta novamente com outro ficheiro.");
      }
    };
    reader.readAsText(file);
  });
}

/* ===== RANKINGS MENSAIS (SIMPLIFICADO) ===== */
function calcularRankingsMensais() {
  const now = new Date();
  const month = now.getMonth();
  const year = now.getFullYear();

  let totalKg = 0;
  let nTreinos = 0;

  treinos.forEach(t => {
    if (!t.data) return;
    const d = new Date(t.data);
    if (d.getFullYear() === year && d.getMonth() === month) {
      const reps = t.rondas * t.reps || 0;
      if (t.peso && reps) {
        totalKg += t.peso * reps;
      }
      nTreinos++;
    }
  });

  return { totalKg, nTreinos };
}

/* ===== INIT ===== */
document.addEventListener("DOMContentLoaded", () => {
  updatePerfilFormFromProfile();
  updatePerfilResumo();
  initSelects();
  renderTable();
  loadTreinos();
  renderTreinos();
  renderReservas();
  renderReservasResumo();
  renderPerformanceWod();
  renderPerformanceRm();
  updateGraphExerciseOptions();

  if (treinoDataEl && !treinoDataEl.value) {
    treinoDataEl.value = new Date().toISOString().slice(0, 10);
  }

  renderBackupInfo();
});
  </script>
</div>
</body>
</html>
